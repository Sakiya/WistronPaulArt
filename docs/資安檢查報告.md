# 資安檢查報告

## 檢查日期
2025-01-XX

## 檢查範圍
- `index.html`
- `js/main.js`
- 其他相關檔案

---

## ✅ 已修復問題

### 1. **target="_blank" 缺少 rel="noopener noreferrer"** ✅ 已修復

**風險等級：** 中高  
**問題描述：** 使用 `target="_blank"` 開啟新分頁時，新頁面可以透過 `window.opener` 存取原頁面，可能導致：
- Tabnabbing 攻擊
- 釣魚網站偽裝
- 原頁面被惡意操作

**發現位置：**
- `index.html:82` - 問卷調查連結
- `index.html:275, 382, 487, 560, 633, 664, 769, 797, 828` - Video.js 支援連結（共 9 處）

**修復狀態：** ✅ **已修復**  
**修復日期：** 2025-01-XX  
**修復內容：** 已為所有 `target="_blank"` 連結添加 `rel="noopener noreferrer"` 屬性

---

## 🟡 中風險問題

### 2. **postMessage 使用萬用字元 '*'**

**風險等級：** 中  
**問題描述：** `postMessage` 使用 `'*'` 作為目標來源，允許任何來源接收訊息。雖然這是 YouTube iframe API 的標準用法，但理論上存在風險。

**發現位置：**
- `js/main.js:678` - YouTube iframe 停止播放
- `js/main.js:823` - 介紹影片 iframe 停止播放

**目前狀態：** 這是 YouTube iframe API 的標準用法，風險較低，因為：
- 訊息是發送給 iframe，不是接收外部訊息
- 訊息內容是固定的 JSON 字串，不包含用戶輸入

**修復建議（可選）：**
```javascript
// 如果可能，指定具體的 YouTube 來源
const youtubeOrigin = 'https://www.youtube.com';
iframe.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}', youtubeOrigin);
```

**注意：** 由於 YouTube iframe 的來源可能因 CDN 而異，使用 `'*'` 可能是必要的。

---

### 3. **innerHTML 使用**

**風險等級：** 低-中（取決於使用方式）  
**問題描述：** 使用 `innerHTML` 清空內容，雖然目前是安全的（只清空，不插入用戶輸入），但應注意未來擴展時的安全性。

**發現位置：**
- `js/main.js:1224` - 清空播放按鈕內容
- `js/main.js:1864` - 清空播放按鈕內容

**目前狀態：** 安全，因為：
- 只使用 `innerHTML = ''` 清空內容
- 不插入任何用戶輸入或動態內容
- 後續使用 `createElement` 和 `appendChild` 安全地插入元素

**修復建議（可選）：**
```javascript
// 可以使用 textContent 或 removeChild 替代
while (playButton.firstChild) {
    playButton.removeChild(playButton.firstChild);
}
```

---

## 🟢 低風險問題

### 4. **location.hash 處理**

**風險等級：** 低  
**問題描述：** 從 URL hash 讀取參數，雖然有基本驗證，但應確保所有使用 hash 的地方都有適當的驗證。

**發現位置：**
- `js/main.js:300, 986` - hash 處理

**目前狀態：** 相對安全，因為：
- 有白名單驗證（`workNames.includes(hash)`）
- 只允許預定義的作品名稱
- 語言參數有驗證（只允許 'en' 或 'zh'）

**建議：** 保持現有的驗證邏輯，確保所有從 hash 讀取的資料都經過驗證。

---

### 5. **localStorage 使用**

**風險等級：** 低  
**問題描述：** 使用 localStorage 儲存語言偏好。

**發現位置：**
- `js/main.js:294, 345` - localStorage 讀寫

**目前狀態：** 安全，因為：
- 只儲存語言偏好（'en' 或 'zh'）
- 有適當的錯誤處理（try-catch）
- 有輸入驗證（只接受 'en' 或 'zh'）

**建議：** 保持現有的驗證和錯誤處理。

---

## ✅ 安全實作

### 1. **XSS 防護**
- ✅ 使用 `textContent` 而非 `innerHTML` 插入文字內容
- ✅ 使用 `createElement` 和 `appendChild` 安全地建立 DOM 元素
- ✅ 翻譯內容來自內部物件，不包含用戶輸入

### 2. **URL 參數驗證**
- ✅ Hash 參數有白名單驗證
- ✅ 作品名稱使用預定義陣列驗證
- ✅ 語言參數有嚴格驗證

### 3. **外部資源載入**
- ✅ YouTube iframe 使用 `referrerpolicy="strict-origin-when-cross-origin"`
- ✅ 外部連結（大部分）已有 `rel="noopener noreferrer"`

---

## 📋 修復優先順序

### ✅ 已完成修復
1. ✅ **已修復** - 為所有 `target="_blank"` 連結添加 `rel="noopener noreferrer"`

### 建議修復（中優先級）
2. ⚠️ 考慮改進 `postMessage` 的目標來源（如果 YouTube API 支援）
   - **狀態：** 待評估（YouTube API 標準用法，風險低）

### 可選改進（低優先級）
3. 💡 考慮使用 `removeChild` 替代 `innerHTML = ''`
   - **狀態：** 可選（目前使用方式安全）

---

## 🔍 其他檢查項目

### ✅ 已檢查項目
- [x] XSS 注入風險
- [x] SQL 注入風險（不適用，純前端專案）
- [x] CSRF 風險（不適用，無表單提交）
- [x] 不安全的 DOM 操作
- [x] 敏感資訊洩露
- [x] 第三方資源安全性
- [x] localStorage 使用安全性
- [x] URL 參數處理安全性

### ⚠️ 注意事項
- 專案為純前端應用，無後端 API 呼叫
- 無用戶輸入表單，XSS 風險較低
- 主要風險來自外部連結的安全性

---

## 📝 總結

**整體安全性：** 🟢 **良好**

專案整體安全性良好，已修復主要問題：
1. ✅ **已修復** - 所有外部連結已添加 `rel="noopener noreferrer"`
2. ⚠️ `postMessage` 使用萬用字元（YouTube API 標準用法，風險低，可接受）

**當前狀態：**
- ✅ 所有高風險問題已修復
- ✅ XSS 防護措施完善
- ✅ URL 參數驗證健全
- ✅ 外部資源載入安全

**建議：**
- 定期檢查第三方套件（Swiper、Video.js）的安全性更新
- 保持現有的安全實作方式
